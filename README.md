# 섹션 9. 빈 생명주기 콜백

## 빈 생명주기 콜백 시작

- 데이터베이스 커넥션 풀, 네트워크 소켓 등 애플리케이션 시작 시점에 필요한 연결을 미리 설정하고, 종료 시점에 연결을 종료하는 작업 필요.
- 스프링을 통해 초기화 작업과 종료 작업 진행 방법 탐구.

## 스프링 빈 간단한 라이프 사이클

- 객체 생성 → 의존관계 주입 (예외: 생성자 주입)
- 스프링은 의존관계 주입 완료 후 빈에게 콜백 메서드를 통해 초기화 시점을 알림.
- 스프링 컨테이너 종료 직전에 소멸 콜백 제공.

## 스프링 빈의 이벤트 라이프 사이클

1. **스프링 컨테이너 생성**
2. **스프링 빈 생성** (생성자 주입 방식에서 의존관계 주입 발생)
3. **의존관계 주입** (필드, setter 주입)
4. **초기화 콜백**
5. **사용**
6. **소멸 전 콜백**
7. **스프링 종료**

### 초기화 및 소멸 콜백

- **초기화 콜백**: 빈 생성 후 의존관계 주입 완료 시 호출.
- **소멸 전 콜백**: 빈 소멸 직전 호출.

## 참고: 객체의 생성과 초기화를 분리하자

- 생성자는 필수 정보를 받고 메모리를 할당하여 객체를 생성함.
- 초기화는 생성된 값을 활용하여 외부 커넥션을 연결하는 등 무거운 동작 수행.
- 생성자 안에서 무거운 초기화 작업을 함께 하는 것보다 객체 생성과 초기화를 명확히 나누는 것이 유지보수 관점에서 유리함.

## 스프링의 빈 생명주기 콜백 지원 방법

1. 인터페이스
2. 설정 정보에 초기화 메서드, 종료 메서드 지정
3. @PostConstruct, @PreDestroy

### 1. 인터페이스 사용

- **InitializingBean**, **DisposableBean** 인터페이스를 통한 초기화 및 소멸.
- **단점**:
    - 스프링 전용 인터페이스로, 해당 코드가 스프링에 의존.
    - 초기화 및 소멸 메서드의 이름을 변경할 수 없음.
    - 외부 라이브러리에 적용할 수 없음.

> 참고: 인터페이스를 사용하는 초기화, 종료 방법은 스프링 초창기에 사용되었으며, 현재는 더 나은 방법으로 인해 거의 사용되지 않음.

### 2. 빈 등록 초기화 및 소멸 메서드

- 설정 정보에 `@Bean(initMethod = "init", destroyMethod = "close")`처럼 초기화 및 소멸 메서드를 지정할 수 있음.

#### 설정 정보 사용 특징

- 메서드 이름을 자유롭게 지정 가능.
- 스프링 빈이 스프링 코드에 의존하지 않음.
- 외부 라이브러리에도 초기화 및 종료 메서드를 적용할 수 있음.

#### 종료 메서드 추론

- `public static final String INFER_METHOD = "(inferred)";`
- `@Bean`의 `destroyMethod` 속성에는 추론 기능이 있음.
- 라이브러리는 보통 `close`, `shutdown` 이름의 종료 메서드를 사용.
- `@Bean`의 `destroyMethod` 기본값은 `(inferred)` 등록.
- 추론 기능 사용 시, `close` 또는 `shutdown` 이름의 메서드 자동 호출.
- 직접 스프링 빈으로 등록하면 종료 메서드는 따로 적어주지 않아도 됨.
- 추론 기능을 사용하지 않으려면 `destroyMethod=""`처럼 빈 공백 지정.

### 3. 애노테이션 사용

- **@PostConstruct**, **@PreDestroy** 애노테이션.

#### 특징

- 최신 스프링에서 가장 권장되는 방법.
- 애노테이션 하나만 붙이면 되므로 편리.
- 스프링에 종속적이지 않은 자바 표준으로, 다른 컨테이너에서도 동작.
- 컴포넌트 스캔과 잘 어울림.
- **단점**: 외부 라이브러리에는 적용할 수 없음. 외부 라이브러리를 초기화, 종료해야 할 경우 `@Bean`의 기능을 사용해야 함.

| 방법 | 설명 | 장점 | 단점 |
| --- | --- | --- | --- |
| 1. 인터페이스 | InitializingBean, DisposableBean 인터페이스를 통한 초기화 및 소멸 | 스프링에서 제공하는 기본 기능 | - 스프링 전용 인터페이스로 의존성 있음<br>- 메서드 이름 변경 불가<br>- 외부 라이브러리에 적용 불가 |
| 2. 빈 등록 초기화 및 소멸 메서드 | @Bean(initMethod = "init", destroyMethod = "close") 설정에서 초기화 및 소멸 메서드 지정 | 메서드 이름 자유롭게 지정 가능<br>스프링 코드에 의존하지 않음<br>외부 라이브러리 적용 가능 | 없음 |
| 3. 애노테이션 | @PostConstruct, @PreDestroy 애노테이션 사용 | 최신 스프링에서 권장<br>편리함<br>자바 표준으로 다른 컨테이너에서도 동작 | 외부 라이브러리에 적용 불가 |
